import p from"critters";import{files as c}from"files-pipe";import m from"files-pipe/dist/lib/apply-to.js";import a from"files-pipe/dist/lib/deepmerge.js";import{fileURLToPath as l}from"url";import n from"./options/index.js";var O=(t={})=>{for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&t[e]===!0&&(t[e]=n[e]);const d=a(n,t),i=new Set;if(typeof t.path<"u"&&(t.path instanceof Array||t.path instanceof Set))for(const e of t.path)i.add(e);return{name:"astro-critters",hooks:{"astro:build:done":async({dir:e})=>{if(i.size||i.add(e),!!t.critters)for(const s of i){const o=await m(s,r=>r instanceof URL?l(r):r),f=new p(a(t.critters,{path:o instanceof Map?o.keys().next().value:o,logLevel:(()=>{switch(t.logger){case 0:return"silent";case 1:return"silent";case 2:return"info";default:return"info"}})()}));await(await(await(await new c(t.logger).in(s)).by("**/*.html")).not(t.exclude)).pipe(a(n.pipe,{wrote:async r=>f.process(r.buffer.toString())}))}}}}};export{O as default};
