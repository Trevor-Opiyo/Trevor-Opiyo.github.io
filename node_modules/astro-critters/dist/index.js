import n from"./options/index.js";import{fileURLToPath as f}from"url";import p from"files-pipeline/dist/lib/apply-to.js";import o from"files-pipeline/dist/lib/deepmerge.js";import{files as c}from"files-pipeline";import l from"critters";var g=(t={})=>{for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&t[e]===!0&&(t[e]=n[e]);t=o(n,t);const a=new Set;if(typeof t.path<"u")if(t.path instanceof Array||t.path instanceof Set)for(const e of t.path)a.add(e);else a.add(t.path);return{name:"astro-critters",hooks:{"astro:build:done":async()=>{if(t.critters)for(const e of a){const i=await p(e,r=>r instanceof URL?f(r):r),s=new l(o(t.critters,{path:i instanceof Map?i.keys().next().value:i,logLevel:(()=>{switch(t.logger){case 0:return"silent";case 1:return"silent";case 2:return"info";default:return"info"}})()}));await(await(await(await new c(t.logger).in(e)).by("**/*.html")).not(t.exclude)).pipeline(o(n.pipeline,{wrote:async r=>s.process(r.buffer)}))}}}}};export{g as default};
